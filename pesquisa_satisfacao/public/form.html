<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="/favicon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulário de Satisfação</title>
    <link rel="stylesheet" href="styles.css">
    <style>
/* ===== Overrides fortes só para o bloco do setor ===== */
#perguntaSetor {
  text-align: left !important;
  background: rgba(255,255,255,0.85) !important;
  border-radius: 10px !important;
  padding: 18px 20px !important;
  margin: 20px 0 24px !important;
  font-family: inherit !important;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  border: 1px solid #e5e9ec !important;
  max-width: 420px;
}

#perguntaSetor .question-header {
  font-size: 18px !important;
  font-weight: 700 !important;
  color: #2b2b2b !important;
  margin-bottom: 8px !important;
}

#perguntaSetor .question-sep {
  height: 2px !important;
  background: #e5e9ec !important;
  margin-bottom: 12px !important;
  border-radius: 1px;
}

#perguntaSetor label.radio-line {
  display: flex !important;
  align-items: center !important;
  gap: 12px !important;
  margin: 12px 0 !important;
  font-size: 17px !important;
  font-weight: 500 !important;
  color: #363636 !important;
  cursor: pointer;
  position: relative;
  padding-left: 0;
}

/* esconde o radio nativo e usa o círculo custom */
#perguntaSetor label.radio-line input[type="radio"] {
  position: absolute !important;
  opacity: 0 !important;
  pointer-events: none !important;
}
#perguntaSetor .radio-ui {
  width: 22px !important;
  height: 22px !important;
  border: 2px solid #cfd6dc !important;
  border-radius: 50% !important;
  display: inline-block !important;
  position: relative !important;
  box-sizing: border-box !important;
  background: #fff;
  transition: border-color 0.2s;
}
#perguntaSetor label.radio-line input[type="radio"]:checked + .radio-ui::after {
  content: "" !important;
  position: absolute !important;
  top: 50%; left: 50%;
  width: 10px; height: 10px;
  transform: translate(-50%,-50%);
  border-radius: 50%;
  background: #3a3a3a !important;
}
#perguntaSetor .radio-line:hover .radio-ui {
  border-color: #9ea8b1 !important;
}
#perguntaSetor label.radio-line input[type="radio"]:focus-visible + .radio-ui {
  outline: 2px solid #9ea8b1 !important;
  outline-offset: 2px !important;
}
#perguntaSetor .radio-text {
  font-size: 17px;
  font-weight: 500;
  color: #363636;
  user-select: none;
}

/* ===== Correções gerais do formulário ===== */
.form-container{
  position: relative;
  z-index: 2;                 /* garante acima do background */
  text-align: left;           /* nada centralizado */
  font-style: normal;
}

/* Labels legíveis e alinhadas */
.form-container label{
  display: block;
  margin: 12px 0 6px;
  font-size: 18px;
  font-weight: 600;
  line-height: 1.25;
  color: #2b2b2b;
  text-align: left !important;
  font-style: normal !important;
}

/* Campos NUNCA transparentes */
.form-container input[type="text"],
.form-container input[type="email"],
.form-container input[type="tel"],
.form-container textarea,
.form-container select{
  background-color: #fff !important;   /* opaco */
  color: #333 !important;
  border: 1px solid rgba(0,0,0,.2);
  border-radius: 6px;
  padding: 12px 14px;
  width: 100%;
  box-sizing: border-box;
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}

/* Placeholder mais discreto */
.form-container ::placeholder{
  color: #a0a0a0;
}

/* Espaço extra entre o bloco do setor e o campo "Seu nome" */
#perguntaSetor{ margin-bottom: 16px; }

/* (opcional) sombreamento suave nos campos */
.form-container input[type="text"],
.form-container textarea{
  box-shadow: 0 1px 2px rgba(0,0,0,.04) inset;
}

/* Se algum CSS global estiver deixando tudo gigante, limita o tamanho dentro do form */
.form-container{ font-size: 16px; }
.form-container *{ font-size: inherit; }  /* herda tamanho padrão do form */

</style>

</head>
<body>
    <script src="header.js"></script>
    <div class="background-image">
        <div class="form-container">
            <h1>Avaliação da Refeição: <span id="meal-name"></span></h1>
            <form id="feedbackForm" method="POST" action="/submit-feedback">
               
                <label>1 - Como você avalia o sabor da refeição?</label>
                <div class="rating">
                    <div class="emoji">
                        <input type="radio" name="sabor_refeicao" value="4" required> 
                        <img src="/img/muito_satisfeito.png" alt="Muito Satisfeito" class="emoji-img">
                        <div class="emoji-description">Muito Satisfeito</div>
                    </div>
                    <div class="emoji">
                        <input type="radio" name="sabor_refeicao" value="3"> 
                        <img src="/img/satisfeito.png" alt="Satisfeito" class="emoji-img">
                        <div class="emoji-description">Satisfeito</div>
                    </div>
                    <div class="emoji">
                        <input type="radio" name="sabor_refeicao" value="2"> 
                        <img src="/img/insatisfeito.png" alt="Insatisfeito" class="emoji-img">
                        <div class="emoji-description">Insatisfeito</div>
                    </div>
                    <div class="emoji">
                        <input type="radio" name="sabor_refeicao" value="1">
                        <img src="/img/muito_insatisfeito.png" alt="Totalmente Insatisfeito" class="emoji-img"> 
                        <div class="emoji-description">Totalmente Insatisfeito</div>
                    </div>
                </div>

                <label>2 - Qual a sua opinião sobre a apresentação da refeição?</label>
                <div class="rating">
                    <div class="emoji">
                        <input type="radio" name="apresentacao_refeicao" value="4" required>
                        <img src="/img/muito_satisfeito.png" alt="Muito Satisfeito" class="emoji-img">
                        <div class="emoji-description">Muito Satisfeito</div>
                    </div>
                    <div class="emoji">
                        <input type="radio" name="apresentacao_refeicao" value="3">
                        <img src="/img/satisfeito.png" alt="Satisfeito" class="emoji-img">
                        <div class="emoji-description">Satisfeito</div>
                    </div>
                    <div class="emoji">
                        <input type="radio" name="apresentacao_refeicao" value="2">
                        <img src="/img/insatisfeito.png" alt="Insatisfeito" class="emoji-img">
                        <div class="emoji-description">Insatisfeito</div>
                    </div>
                    <div class="emoji">
                        <input type="radio" name="apresentacao_refeicao" value="1">
                        <img src="/img/muito_insatisfeito.png" alt="Totalmente Insatisfeito" class="emoji-img">
                        <div class="emoji-description">Totalmente Insatisfeito</div>
                    </div>
                </div>

                <label>3 - E a temperatura dos pratos?</label>
                <div class="rating">
                    <div class="emoji">
                        <input type="radio" name="temperatura_refeicao" value="4" required> 
                        <img src="/img/muito_satisfeito.png" alt="Muito Satisfeito" class="emoji-img">
                        <div class="emoji-description">Muito Satisfeito</div>
                    </div>
                    <div class="emoji">
                        <input type="radio" name="temperatura_refeicao" value="3">
                        <img src="/img/satisfeito.png" alt="Satisfeito" class="emoji-img"> 
                        <div class="emoji-description">Satisfeito</div>
                    </div>
                    <div class="emoji">
                        <input type="radio" name="temperatura_refeicao" value="2"> 
                        <img src="/img/insatisfeito.png" alt="Insatisfeito" class="emoji-img">
                        <div class="emoji-description">Insatisfeito</div>
                    </div>
                    <div class="emoji">
                        <input type="radio" name="temperatura_refeicao" value="1"> 
                        <img src="/img/muito_insatisfeito.png" alt="Totalmente Insatisfeito" class="emoji-img">
                        <div class="emoji-description">Totalmente Insatisfeito</div>
                    </div>
                </div>

                <label>4 - Sobre a limpeza e organização do restaurante, qual a sua nota?</label>
                <div class="rating">
                    <div class="emoji">
                        <input type="radio" name="limpeza_organizacao" value="4" required>
                        <img src="/img/muito_satisfeito.png" alt="Muito Satisfeito" class="emoji-img">
                        <div class="emoji-description">Muito Satisfeito</div>
                    </div>
                    <div class="emoji">
                        <input type="radio" name="limpeza_organizacao" value="3"> 
                        <img src="/img/satisfeito.png" alt="Satisfeito" class="emoji-img">
                        <div class="emoji-description">Satisfeito</div>
                    </div>
                    <div class="emoji">
                        <input type="radio" name="limpeza_organizacao" value="2">
                        <img src="/img/insatisfeito.png" alt="Insatisfeito" class="emoji-img"> 
                        <div class="emoji-description">Insatisfeito</div>
                    </div>
                    <div class="emoji">
                        <input type="radio" name="limpeza_organizacao" value="1">
                        <img src="/img/muito_insatisfeito.png" alt="Totalmente Insatisfeito" class="emoji-img"> 
                        <div class="emoji-description">Totalmente Insatisfeito</div>
                    </div>
                </div>

                <label>5 - Por último, como você avalia o atendimento da equipe?</label>
                <div class="rating">
                    <div class="emoji">
                        <input type="radio" name="atendimento_equipa" value="4" required>
                        <img src="/img/muito_satisfeito.png" alt="Muito Satisfeito" class="emoji-img"> 
                        <div class="emoji-description">Muito Satisfeito</div>
                    </div>
                    <div class="emoji">
                        <input type="radio" name="atendimento_equipa" value="3">
                        <img src="/img/satisfeito.png" alt="Satisfeito" class="emoji-img">
                        <div class="emoji-description">Satisfeito</div>
                    </div>
                    <div class="emoji">
                        <input type="radio" name="atendimento_equipa" value="2">
                        <img src="/img/insatisfeito.png" alt="Insatisfeito" class="emoji-img">
                        <div class="emoji-description">Insatisfeito</div>
                    </div>
                    <div class="emoji">
                        <input type="radio" name="atendimento_equipa" value="1">
                        <img src="/img/muito_insatisfeito.png" alt="Totalmente Insatisfeito" class="emoji-img">
                        <div class="emoji-description">Totalmente Insatisfeito</div>
                    </div>
                </div>

                <div id="perguntaSetor" class="question-card" hidden>
                        <div class="question-header">Qual o seu setor?</div>
                        <div class="question-sep"></div>
                    
                    <label class="radio-line">
                        <input type="radio" name="setor" value="Administrativo">
                        <span class="radio-ui"></span>
                        <span class="radio-text">Administrativo</span> 
                    </label>
                    <label class="radio-line">
                        <input type="radio" name="setor" value="Operacional">
                        <span class="radio-ui"></span>
                        <span class="radio-text">Operacional</span>

                    </label>
                </div>


                <label for="name">Seu nome (Opcional):</label>
                <input type="text" id="name" name="nome">
                


                <label for="comments">Deixe aqui seu comentário! (elogio, sugestão ou reclamação): (Opcional)</label>
                <textarea name="comentario" id="comments"></textarea>

                <button type="submit" id="submit-button">Enviar Avaliação</button>
            </form>
        </div> 
    </div>

    <script>
        // Função para capturar parâmetros da URL
        function getParameterByName(name, url = window.location.href) {
            name = name.replace(/[\[\]]/g, '\\$&');
            let regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }

        // Carrega os valores da URL ou do localStorage quando a página é carregada
        document.addEventListener("DOMContentLoaded", function() {
            const unidadeURL = getParameterByName('unidade');
            const tipoRefeicaoURL = getParameterByName('tipo_refeicao');

            const unidadeSalva = localStorage.getItem("unidade");
            const tipoRefeicaoSalva = localStorage.getItem("tipo_refeicao");

            // Preenche os campos com os valores da URL, se existirem
            if (unidadeURL) {
                document.getElementById("unidade").value = unidadeURL;
            } else if (unidadeSalva) {
                document.getElementById("unidade").value = unidadeSalva;
            }

            if (tipoRefeicaoURL) {
                document.getElementById("tipo_refeicao").value = tipoRefeicaoURL;
                document.getElementById("meal-name").textContent = tipoRefeicaoURL.charAt(0).toUpperCase() + tipoRefeicaoURL.slice(1);
            } else if (tipoRefeicaoSalva) {
                document.getElementById("tipo_refeicao").value = tipoRefeicaoSalva;
                document.getElementById("meal-name").textContent = tipoRefeicaoSalva.charAt(0).toUpperCase() + tipoRefeicaoSalva.slice(1);
            }
        });

        // Validação antes de enviar o formulário
        document.getElementById("feedbackForm").onsubmit = function(event) {
            const unidade = document.getElementById("unidade").value;
            const tipoRefeicao = document.getElementById("tipo_refeicao").value;

            // Valida se os campos estão preenchidos
            if (!unidade || !tipoRefeicao) {
                alert("Unidade e Tipo de Refeição são obrigatórios. Verifique a URL ou preencha os campos manualmente.");
                event.preventDefault(); // Impede o envio do formulário
                return false;
            }

            // Salva os valores no localStorage
            localStorage.setItem("unidade", unidade);
            localStorage.setItem("tipo_refeicao", tipoRefeicao);
        };
        
        document.getElementById("feedbackForm").addEventListener("submit", function(event) {
    // Desabilita o botão de envio
    const submitButton = document.getElementById("submit-button");
    submitButton.disabled = true;
    submitButton.textContent = "Enviando..."; // Altera o texto do botão

});

async function atualizarPerguntaSetor(){
  // durante o teste: force=1; depois REMOVA o ?force=1
  const r = await fetch('/api/pergunta-setor?force=1');
  const { mostrarPerguntaSetor } = await r.json();
  const box = document.getElementById('perguntaSetor');
  if (!box) return;
  box.hidden = !mostrarPerguntaSetor;
  if (!mostrarPerguntaSetor) {
    document.querySelectorAll('input[name="setor"]').forEach(i => i.checked = false);
  }
}
document.addEventListener('DOMContentLoaded', atualizarPerguntaSetor);
    </script>
    <script src="script.js"></script>
</body>
</html>